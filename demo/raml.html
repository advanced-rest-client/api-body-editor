<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <title>api-body-editor demo</title>

  <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../../../web-animations-js/web-animations-next.min.js"></script>

  <script type="module">
    import '@polymer/iron-demo-helpers/demo-pages-shared-styles.js';
    import '@polymer/polymer/lib/elements/dom-bind.js';
    import '@polymer/paper-dropdown-menu/paper-dropdown-menu.js';
    import '@polymer/paper-item/paper-item.js';
    import '@polymer/paper-listbox/paper-listbox.js';
    import '@polymer/paper-toggle-button/paper-toggle-button.js';
    import '@polymer/paper-toast/paper-toast.js';
    import '@api-components/api-navigation/api-navigation.js';
    import '@api-components/api-console-default-theme/api-console-default-theme.js';
    import '@api-components/raml-aware/raml-aware.js';
    import '../api-body-editor.js';
  </script>

  <custom-style>
    <style is="custom-style" include="demo-pages-shared-styles">
    body,
    html {
      background-color: #e5e5e5;
      height: 100vh;
      margin: 0;
      padding: 0;
    }

    [role="main"] {
      max-width: 1100px;
      @apply --layout-horizontal;
      @apply --layout-start;
    }

    .card {
      @apply --shadow-elevation-4dp;
      padding: 20px;
      margin-top: 20px;
      margin-bottom: 20px;
      box-sizing: border-box;
      background-color: #fff;
    }

    header {
      padding: 12px 24px;
      background-color: #C5E1A5;
      @apply --layout-horizontal;
      @apply --layout-center;
      --iron-icon-fill-color: #3E2723;
      --paper-input-container-focus-color: #33691E;
      --paper-input-container-label: {
        color: #3E2723;
      };
    }

    .spacer {
      @apply --layout-flex;
    }

    .options {
        @apply --layout-horizontal;
        @apply --layout-center;
    }

    .options > * {
      margin-left: 8px;
    }

    output {
      display: block;
      margin-top: 24px;
      white-space: pre-wrap;
      @apply --paper-font-code1;
    }

    .main {
      margin-top: 40px;
      @apply --shadow-elevation-4dp;
      padding: 24px;
      margin-bottom: 40px;
    }

    h1 {
      @apply --paper-font-display1;
    }

    h2 {
      @apply --paper-font-title;
    }

    paper-toggle-button {
      margin-bottom: 12px;
    }
    </style>
  </custom-style>

  <!--
  With HTML imports this was relatively easy task to perform inside web component.
  With module imports it's all get very messy with legacy scripts (using webpack or whatever).
  This scripts cannot be loaded inside the the module as it wont be added to the window object.
  CodeMirror uses `this` instead of `window` or `self` and do not exports any instance.
  Therefore the CM scripts has to be loaded outside the componet.
  -->
  <script src="../../../jsonlint/lib/jsonlint.js"></script>
  <script src="../../../codemirror/lib/codemirror.js"></script>
  <script src="../../../codemirror/addon/mode/loadmode.js"></script>
  <script src="../../../codemirror/mode/meta.js"></script>
  <script src="../../../codemirror/mode/javascript/javascript.js"></script>
  <script src="../../../codemirror/mode/xml/xml.js"></script>
  <script src="../../../codemirror/mode/htmlmixed/htmlmixed.js"></script>
  <script src="../../../codemirror/addon/lint/lint.js"></script>
  <script src="../../../codemirror/addon/lint/json-lint.js"></script>
  <!--
  From the inside of the web component it is hard to determine where
  scripts are actually located. This should be set if the page won't load all possible
  scripts at run time. The component will download the "mode" from this location.
  -->
  <script>
  /* global CodeMirror */
  CodeMirror.modeURL = '../../../codemirror/mode/%N/%N.js';
  </script>
</head>
<body>
  <dom-bind id="demo">
    <template>
      <header>
        <paper-dropdown-menu label="Select demo endpoint">
          <paper-listbox slot="dropdown-content" id="apisList" on-selected-changed="_apiChanged">
            <paper-item data-src="demo-api.json">Demo api</paper-item>
            <paper-item data-src="demo-api-compact.json">Demo api - compact model</paper-item>
            <paper-item data-src="examples-api.json">Examples render demo api</paper-item>
            <paper-item data-src="examples-api-compact.json">Examples render demo - compact model</paper-item>
            <paper-item data-src="apic-169.json">apic-169</paper-item>
            <paper-item data-src="apic-169-compact.json">apic-169 - compact model</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>
        <div class="spacer"></div>
        <div class="options">
          <paper-toggle-button checked="{{narrow}}">Render narrow view</paper-toggle-button>
          <paper-toggle-button checked="{{allowCustom}}">Allow custom properties</paper-toggle-button>
          <paper-toggle-button checked="{{readonly}}">Read only mode</paper-toggle-button>
        </div>
      </header>

      <raml-aware raml="{{amfModel}}" scope="model"></raml-aware>
      <section role="main" class="centered card">
        <api-navigation aware="model" endpoints-opened=""></api-navigation>
        <api-body-editor value="{{value}}" aware="model" amf-body="[[selectedBody]]" narrow="[[narrow]]" readonly="[[readonly]]" allow-hide-optional="" allow-disable-params="" allow-custom="[[allowCustom]]"></api-body-editor>
      </section>

      <section class="vertical-section-container centered card">
        <h2>Output</h2>
        <output>[[value]]</output>
      </section>

      <section class="vertical-section-container centered card">
        <h2>Request headers editor</h2>
        <api-headers-editor allow-hide-optional="" allow-disable-params="" allow-custom=""></api-headers-editor>
      </section>

      <demo-element id="helper" amf-model="{{amfModel}}"></demo-element>
      <paper-toast id="toast"></paper-toast>
    </template>
  </dom-bind>
  <script type="module">
  import {PolymerElement} from '@polymer/polymer/polymer-element.js';
  import {AmfHelperMixin} from '@api-components/amf-helper-mixin';

  class DemoElement extends AmfHelperMixin(PolymerElement) {}
  window.customElements.define('demo-element', DemoElement);
  (function(app) {
    app._load = function() {
      document.getElementById('apisList').selected = 0;
    };

    app._loadFile = function(file) {
      fetch('./' + file)
      .then((response) => response.json())
      .then((data) => {
        app.amfModel = data;
      });
    };

    app._apiChanged = function(e) {
      const file = e.target.selectedItem.dataset.src;
      app._loadFile(file);
    };

    app._navChanged = function(e) {
      const type = e.detail.type;
      if (type === 'method') {
        app.setData(e.detail.selected);
        app.hasData = true;
      } else {
        app.hasData = false;
      }
    };

    app.setData = function(selected) {
      const webApi = app.$.helper._computeWebApi(app.amfModel);
      const body = app.$.helper._computeMethodModel(webApi, selected);
      app.selectedBody = body;
    };

    app._ctChanged = function(e) {
      const toast = document.getElementById('toast');
      toast.text = `Content type changed: ${e.detail.value}`;
      toast.opened = true;
    };
    window.addEventListener('WebComponentsReady', app._load);
    window.addEventListener('content-type-changed', app._ctChanged);
    window.addEventListener('api-navigation-selection-changed', app._navChanged);
  })(document.getElementById('demo'));
  </script>
</body>
</html>
